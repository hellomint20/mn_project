<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.care.am.mapper.reservationMapper">

	<resultMap type="com.care.am.dto.reservationDTO" id="reservation">
		<id property="rNum" column="r_num"/>
		<result property="mId" column="m_id"/>
		<result property="cId" column="c_id"/>
		<result property="rContent" column="r_content"/>
		<result property="rDate" column="r_date"/>
		<result property="rTime" column="r_time"/>
		<result property="rApply" column="r_apply"/>
		<result property="rName" column="r_name"/>
		<result property="rTel" column="r_tel"/>
		<result property="rName" column="r_name"/>
	</resultMap>
	
	<resultMap type="com.care.am.dto.petDTO" id="pet">
		<id property="pNum" column="p_num"/>
		<result property="pName" column="p_name" />
		<result property="pSection" column="p_section" />
		<result property="pType" column="p_type" />
		<result property="pAge" column="p_age" />
		<result property="pSex" column="p_sex" />
		<result property="cId" column="c_id" />
		<result property="pPhoto" column="pPhoto" />
	</resultMap>
	
	<resultMap type="com.care.am.dto.customerDTO" id="customer">
		<id property="cId" column="c_id"/>
		<result property="cPw" column="c_pw"/>
		<result property="cName" column="c_name"/>
		<result property="cTel" column="c_tel"/>
		<result property="cEmail" column="c_email"/>
		<result property="cSessionId" column="c_session"/>
	</resultMap>

	<select id="mediReservationList" resultType="map">
		select
	reservation.r_date, reservation.r_time, pet.p_type, reservation.r_content, reservation.r_apply
		from reservation left join pet
			on reservation.p_num = pet.p_num
				where reservation.m_id = #{mId} and not r_apply in ("대기")
	</select>
	
	<select id="mediReservationWaitList" resultType="map">
		select
		reservation.r_num, reservation.r_date, reservation.r_time, pet.p_type, reservation.r_content, reservation.r_apply
		from reservation left join pet
			on reservation.p_num = pet.p_num
		where reservation.m_id = #{mId} and r_apply= "대기"
	</select>
	
	<select id="reservationInfo" resultType="map">
		select customer.c_email, reservation.r_date, reservation.r_time, reservation.r_name, customer.c_tel, pet.p_section, pet.p_type, pet.p_name, pet.p_sex, pet.p_age, reservation.r_content, pet.p_photo
		from reservation 
		join customer on reservation.c_id = customer.c_id
    	join pet on reservation.p_num = pet.p_num
		where reservation.r_num = #{rNum}
	</select>
	
	<select id="pagingList" parameterType="hashMap" resultType="map">
		select r_time, r_content, r_apply, r_date, p_type
		from reservation, pet
		where m_id=#{mId}
		order by r_date 
		limit #{start}, #{limit}
	</select>
	
	<!-- 승인/취소 테이블 페이징 -->
	<select id="mediReservationListCount" resultType="Integer">
		select 
		count(*) from reservation left join pet on reservation.p_num = pet.p_num
		where reservation.m_id = #{mId} and not reservation.r_apply in('대기')
	</select>
	
	
	<!--  
	<select id="selectListCount" resultType="Integer">
		select count(*) from reservation where m_id=#{mId}
	</select>-->
	
	
	
	
	
	
	<!-- 새로운 접수 -->
	<select id="waitList" parameterType="hashMap" resultType="map">
		select r_time, r_content, r_apply, r_date, p_type
		from reservation, pet
		where m_id = ${mId} and  r_apply = "대기"
		order by r_date 
		limit #{start}, #{limit}
	</select>
	
	<!-- 새로운 접수 페이징 -->
	<select id="waitListPaging" resultType="Integer">
		select 
		count(*) from reservation left join pet on reservation.p_num = pet.p_num
		where reservation.m_id = #{mId} and not reservation.r_apply in('대기')
	</select>
	
	
	
	<!-- 승인취소 -->
	<select id="ACList" parameterType="hashMap" resultType="map">
		select r_time, r_content, r_apply, r_date, p_type
		from reservation, pet
		where m_id = ${mId} and not r_apply in ("대기")
		order by r_date 
		limit #{start}, #{limit}
	</select>
	
	<!-- 승인취소 페이징 -->
	<select id="ACListPaging" resultType="Integer">
		select 
		count(*) from reservation left join pet on reservation.p_num = pet.p_num
		where reservation.m_id = #{mId} and not reservation.r_apply in('대기')
	</select>
	

</mapper>